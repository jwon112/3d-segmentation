# 포그라운드 비율 0.64%에 대한 설명

## 질문: "뇌 전체에서 종양이 차지하는 부분이 0.64%보다 많지 않나?"

**답변: 맞습니다. 하지만 계산 방식에 차이가 있습니다.**

## 핵심 차이점

### 1. **"전체 볼륨" vs "뇌 조직 영역"**

**현재 계산 (0.64%):**
- **전체 볼륨 (240 x 240 x 155 = 8,928,000 복셀) 대비**
- 배경 (뇌 외부, 공기, 두개골 밖) 포함
- **결과**: 종양 / 전체 볼륨 = 57,305 / 8,928,000 = **0.64%**

**의미 있는 계산:**
- **뇌 조직 영역 대비**
- 뇌 조직만 고려 (배경 제외)
- **결과**: 종양 / 뇌 조직 영역 = 훨씬 높은 비율 (보통 1-10% 범위)

### 2. BraTS 볼륨의 특성

**BraTS 볼륨 크기: 240 x 240 x 155**
- 이 볼륨은 **전체 두뇌를 포함하는 ROI (Region of Interest)**
- 뇌 조직은 이 볼륨의 **일부분만** 차지
- 나머지는 **두개골, 공기, 배경** 등

**일반적인 분포 (추정):**
```
전체 볼륨 (240 x 240 x 155)
├── 배경 (두개골 밖, 공기): ~40-60%
├── 뇌 조직 영역: ~30-50%
│   ├── 정상 뇌 조직: ~90-95%
│   └── 종양 (포그라운드): ~1-10%  ← 이게 더 의미 있는 비율!
└── 기타 (두개골 등): ~10-20%
```

### 3. 실제 종양 비율 (뇌 조직 대비)

**예상되는 실제 비율:**
- 뇌 조직 영역이 전체 볼륨의 약 40%라고 가정
- 종양이 뇌 조직의 약 2-5%라고 가정
- → 전체 볼륨 대비로 계산하면: 40% × 2-5% = **0.8-2%**

**이것이 0.64%와 유사합니다!**

## 확인 방법

실제 NIfTI 파일에서 뇌 조직 영역을 추정하여 확인할 수 있습니다:

```python
# 뇌 조직 마스크 (라벨 > 0이거나 이미지 값 > 임계값)
brain_mask = (image > threshold) | (label > 0)
brain_voxels = brain_mask.sum()

# 종양 비율 (뇌 조직 대비)
tumor_in_brain_ratio = fg_voxels / brain_voxels * 100
# 예상: 1-10% 범위
```

## 왜 이렇게 계산하는가?

### 현재 방식 (전체 볼륨 대비):
- ✅ **일관성**: 모든 데이터셋에서 동일한 기준
- ✅ **간단함**: 별도 마스크 불필요
- ❌ **의미 부족**: 배경 포함으로 비율이 매우 낮음

### 뇌 조직 대비 방식:
- ✅ **의미 있음**: 실제 종양 비율 반영
- ✅ **임상적 해석**: 의사가 이해하기 쉬움
- ❌ **복잡함**: 뇌 마스크 필요
- ❌ **불일치**: 데이터셋마다 마스크 기준 다름

## 결론

**0.64%는 전체 볼륨 대비 비율이며, 이는 정상입니다.**

**뇌 조직만 고려하면:**
- 종양 비율은 **1-10% 범위**로 훨씬 높습니다
- 이는 실제 임상적으로 더 의미 있는 수치입니다

**따라서:**
- 0.64% 자체는 문제가 아닙니다
- 하지만 **클래스 불균형 문제는 여전히 존재**합니다
- 모델이 배경을 예측하는 것이 "안전한" 전략이 됩니다

**해결책:**
- 클래스 가중치 추가 (배경 가중치 ↓, 포그라운드 가중치 ↑)
- Focal Loss 사용
- nnU-Net 스타일 샘플링 (이미 적용됨)

